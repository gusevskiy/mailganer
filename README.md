# mailganer

Задание:
Написать на Python 2.7 / Django 1.9.9 (другие версии или программы не принимаем) небольшой сервис отправки имейл рассылок.

Возможности сервиса:

1. Отправка рассылок с использованием html макета и списка подписчиков.

2. Для создания рассылки использовать ajax запрос. Форма для создания рассылки заполняется в модальном окне. Использовать библиотеки: jquery, bootstrap.

3. Отправка отложенных рассылок.

4. Использование переменных в макете рассылки. (Пример: имя, фамилия, день рождения из списка подписчиков)

5. Отслеживание открытий писем.

Отложенные отправки реализовать при помощи Celery.

### Пояснение

Логику рассылки сделал простую, пользователь получает письмо с неким текстом и открыв письмо нажимает "Узнать подробности" или "Отписаться". При клике отправляется запрос на сервер с пометкой пользователь "отписался" или "пользователь заинтересовался". В админ панели можно увидель все рассылки, какие они, отложенные были или нет и emails на которые она была отправлена. И по каждому email можно увидеть что сделал пользователь и когда.  
Реализовать логику обратного вызова с помощью трекинга открытий ссылкой в картинке, не проходит тк почтовые сервисы блокируют и подменяют ссылки на свои.

Результат:
1) html макет ОК
2) ajax модальное окно bootstrap ОК
3) Отложеные tasks celery ОК
4) Использование переменных ОК (подгружаю emails подписчиков в форму) ОК
5) Отслеживание открытий (только если пользователь кликнет) None


### Техноголии
``` 
    celery==3.1.25
    Django==1.9.9
    kombu==3.0.37
    redis==2.10.6
    requests==2.27.1
    tornado==4.2
```
линтер `yapf -i -r .`

### Скачать/Запустить
```
git clone git@github.com:gusevskiy/mailganer.git
. venv/bin/activate
pip install -r requirements.txt 
```
Для локального доступа к проекту я использовал [ZROK](https://docs.zrok.io/docs/guides/install/)

Заполнить .env файл 
```
SECRET_KEY="xle@xy$d!p9h%n8w)e7-e!wz6lzkb#q6l@$jvuty)&&st$ckhp"
EMAIL_HOST_PASSWORD = '11111111111111111111111'
EMAIL_HOST_USER = '1111111111111@111111111111.ru'
DEFAULT_FROM_EMAIL = '111111111111111@11111111111111.ru'
SITE_URL='https://1111111111111.share.zrok.io'
```
Заполнить список предпологаемых подписчиков файл subsсriber.json emails на которые будут приходить письма
```json
[
    {
        "email": "111111111111111",
        "first_name": "Ангелина",
        "last_name": "Тимофеева",
        "birth_date": "1981-02-15"
    },
    {
        "email": "2222222222222222222",
        "first_name": "Михаил",
        "last_name": "Кравцов",
        "birth_date": "1981-02-15"
    },
    {
        "email": "33333333333333333333333333333",
        "first_name": "Иван",
        "last_name": "Журавлев",
        "birth_date": "1981-02-15"
    }
]
```
Загрузить подписчиков в БД и создать супер пользователя. 
```
python manage,py load_subscriber
python manage.py createsuperuser
```
В разных терминалах.

Запустить redis
```
docker run -d --name redis -p 6379:6379 redis:3.2
```
Запустить порект 
```
python manage.py runserver
```
Запустить celery
```
celery -A mailing worker -i info
```
